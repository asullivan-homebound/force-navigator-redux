# Fix Active Flow URL Construction Specification

- **User Story:** As a user, when I select an "Active Flow" from the command palette, I want the URL to be constructed correctly (absolute URL) so that it opens the Flow Builder successfully, instead of appending the target domain to the current page's URL (resulting in a 404).
- **Acceptance Criteria:**
    - [ ] The "Active Flow" commands generated by `getActiveFlows` must have URLs starting with `https://`.
    - [ ] The generated URL should follow the format: `https://<domain>/builder_platform_interaction/flowBuilder.app?flowId=<FlowVersionId>`.
    - [ ] Verify that clicking an Active Flow command opens the correct page in a new tab or current tab (depending on modifier keys).
    - [ ] Ensure no regression for other commands (Objects, Users).

- **Technical Implementation:**

  - **`src/serviceWorker.js`**:
    - **Note:** Do not modify `src/background.js`; it appears to be an unused file. The active background script is `src/serviceWorker.js`.
    - Locate the `getActiveFlows` message handler.
    - Modify the `flowTargetUrl` construction.
    - Currently: `let flowTargetUrl = request.domain + "/builder_platform_interaction/flowBuilder.app?flowId="`
    - Change to: `let flowTargetUrl = "https://" + request.domain + "/builder_platform_interaction/flowBuilder.app?flowId="`
    - **Context:** `request.domain` is populated from `forceNavigator.serverInstance` (in `shared.js`), which has recently been updated to correctly include `.sandbox` segments. By prepending `https://`, we create an absolute URL.
    - **Why:** This ensures `goToUrl` (in `serviceWorker.js`) treats it as an absolute URL and bypasses its relative-path reconstruction logic (which causes the root URL duplication issue).

- **Test Coverage:**
  - **Unit Tests:**
    - `getActiveFlows`: Mock the `request` object with a known domain (e.g., `test.lightning.force.com`) and verify the output URL in the response matches `https://test.lightning.force.com/builder...`.
  - **Manual Verification:**
    - Search for a flow in the palette.
    - Click it.
    - Check the address bar for the correct URL.